<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>PrÃ©dicteur Aviator â€” IA hybride amÃ©liorÃ©e + Graphiques</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --bg:#0d1117; --card:#15181d; --accent:#00d4ff; --muted:#9aa4b2; --good:#4caf50; --warn:#ffb74d; --bad:#ff5252;
    }
    body{background:var(--bg); color:#e6eef6; font-family:Inter,Arial,Helvetica,sans-serif; padding:18px; display:flex; justify-content:center;}
    .card{width:520px; background:var(--card); border-radius:12px; padding:18px; box-shadow:0 8px 32px rgba(0,0,0,0.6);}
    h1{margin:0 0 8px; font-size:20px; color:var(--accent); text-align:center;}
    label{font-size:13px; color:var(--muted); display:block; margin-top:10px;}
    textarea, input, select, button{
      width:100%; margin-top:8px; padding:10px 12px; border-radius:8px;
      border:1px solid rgba(255,255,255,0.04); background:#0f1720; color:#e6eef6;
      font-size:14px; box-sizing:border-box; font-family: monospace;
    }
    textarea {height:90px; resize:vertical;}
    .row{display:flex; gap:8px;}
    .small{width:48%;}
    button{
      background:linear-gradient(90deg,var(--accent),#6ef0ff); color:#021018;
      font-weight:700; border:none; cursor:pointer; padding:10px 12px;
    }
    .result{margin-top:12px; padding:12px; border-radius:10px; background:rgba(255,255,255,0.02); font-size:14px; white-space:pre-wrap;}
    .muted{color:var(--muted); font-size:12px;}
    .patterns{margin-top:10px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:13px;}
    footer{margin-top:12px;font-size:12px;color:var(--muted); text-align:center;}
    canvas{margin-top:15px;}
  </style>
</head>
<body>
  <div class="card">
    <h1>ðŸŽ¯ PrÃ©dicteur Aviator â€” IA hybride amÃ©liorÃ©e</h1>
    <label>Historique (format : <code>1.2x, 3.4x, 2.5x, ...</code>) :</label>
    <textarea id="history" placeholder="Ex : 1.2x, 3.4x, 2.5x, 15x, 1.1x"></textarea>
    <div class="row" style="margin-top:6px;">
      <input id="server" class="small" placeholder="ID serveur (optionnel)" />
      <input id="lastRound" class="small" placeholder="Dernier numÃ©ro de tour (optionnel)" />
    </div>
    <div class="row" style="margin-top:8px;">
      <select id="mode" class="small" style="width:100%;">
        <option value="balanced">Mode : Ã‰quilibrÃ©</option>
        <option value="aggressive">Mode : Agressif</option>
        <option value="conservative">Mode : Conservateur</option>
      </select>
      <button id="btnPredict" style="width:40%;">ðŸ“ˆ PrÃ©dire</button>
    </div>
    <canvas id="chartHistory" height="150"></canvas>
    <div class="result" id="result"><div class="muted">RÃ©sultats s'afficheront ici aprÃ¨s prÃ©diction.</div></div>
    <div class="patterns" id="patterns" style="display:none;"></div>
    <div class="result" id="autoSummary" style="display:none; margin-top:12px; padding:12px; border-radius:10px; background:rgba(255,255,255,0.02); font-size:14px; white-space:pre-wrap;"></div>
    <footer>Algorithme : multi-fenÃªtres + RSI + MACD + patterns enrichis Â· Confiance calibrable</footer>
  </div>

<script>
// --- Coller ici le code multiWindowPredict amÃ©liorÃ© fourni prÃ©cÃ©demment ---
// Pour l'exemple, voici une fonction simulÃ©e, Ã  remplacer par ton implÃ©mentation rÃ©elle
function multiWindowPredict(values, server, mode) {
  // Simulation simplifiÃ©e pour tester le fonctionnement complet
  return {
    predN2: (values[values.length-1] + 1).toFixed(2),
    predN3: (values[values.length-1] + 2).toFixed(2),
    trust2: Math.floor(Math.random() * 100),
    trust3: Math.floor(Math.random() * 100),
    features: {
      short: {
        avg: values.slice(-5).reduce((a,b)=>a+b,0)/Math.min(5,values.length),
        vol: 0.5,
        rsi: 45,
        macd: { hist: 0.03 }
      }
    },
    explanation: [
      "Analyse multi-fenÃªtres activÃ©e",
      "RSI et MACD indiquent tendance stable",
      "Confiance calculÃ©e selon historique rÃ©cent"
    ]
  };
}

function parseHistory(txt){
  if(!txt) return [];
  return txt.split(/[\n,;]+/).map(s => s.replace(/x/ig,'').trim()).filter(s => s).map(Number).filter(n => !isNaN(n));
}

let chartInstance = null;
function renderChart(values, avgSeries){
  const ctx = document.getElementById('chartHistory').getContext('2d');
  if(chartInstance) chartInstance.destroy();
  chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: values.map((_,i)=>i+1),
      datasets: [
        { label: 'Multiplicateurs', data: values, borderColor: '#00d4ff', backgroundColor: 'rgba(0,212,255,0.2)', fill: true, tension: 0.3 },
        { label: 'Moyenne mobile (5)', data: avgSeries, borderColor: '#4caf50', borderDash:[5,5], fill:false, tension: 0.3 }
      ]
    },
    options: {
      responsive: true,
      plugins: { legend: { labels: { color:'#e6eef6' } } },
      scales: {
        x: { ticks: { color:'#e6eef6' }, grid: { color:'rgba(255,255,255,0.05)' } },
        y: { ticks: { color:'#e6eef6' }, grid: { color:'rgba(255,255,255,0.05)' } }
      }
    }
  });
}

const btn = document.getElementById('btnPredict');
const summaryEl = document.getElementById('autoSummary');

function autoStrategySummary(trust2, trust3) {
  let action = "Passer";
  let plan = "";
  let stake = "â€”";

  if (trust2 >= 80 && trust3 < 40) {
    action = "Jouer";
    plan = "Full 2x";
    stake = "2â€“4% bankroll";
  } else if (trust2 >= 60 && trust3 < 40) {
    action = "Jouer (sÃ©lectif)";
    plan = "Full 2x";
    stake = "1â€“2% bankroll";
  } else if (trust2 >= 80 && trust3 >= 60) {
    action = "Jouer";
    plan = "Split 50% Ã  2x, reste vise 3x";
    stake = "2â€“4% bankroll";
  } else if (trust3 >= 45 && trust2 >= 70) {
    action = "Jouer (opportunitÃ©)";
    plan = "Split ou Full 3x si bankroll solide";
    stake = "1â€“2% bankroll";
  }

  return { action, plan, stake };
}

btn.addEventListener('click', ()=>{
  const raw = document.getElementById('history').value;
  const server = document.getElementById('server').value.trim();
  const lastRound = document.getElementById('lastRound').value.trim();
  const mode = document.getElementById('mode').value;
  const values = parseHistory(raw);
  const resEl = document.getElementById('result');
  const patternsEl = document.getElementById('patterns');

  if(values.length < 4){
    resEl.innerHTML = "<div class='muted'>Pas assez de donnÃ©es â€” entre au moins 4 valeurs.</div>";
    patternsEl.style.display = 'none';
    summaryEl.style.display = 'none';
    return;
  }
  const out = multiWindowPredict(values, server, mode);
  if(out.error){
    resEl.innerHTML = `<div class='muted'>${out.error}</div>`;
    patternsEl.style.display = 'none';
    summaryEl.style.display = 'none';
    return;
  }
  let text = "";
  if(lastRound) text += `Dernier tour : #${lastRound}\n`;
  if(server) text += `Serveur : ${server}\n`;
  text += `\nðŸ”­ PrÃ©diction N+2 : ${out.predN2}x\nðŸš€ PrÃ©diction N+3 : ${out.predN3}x\n\n`;
  text += `ðŸ“ˆ Confiance â‰¥2x : ${out.trust2}%\nðŸš€ Confiance â‰¥3x : ${out.trust3}%\n\n`;
  text += `ðŸ“Š Moyenne (5 derniers) : ${out.features.short.avg.toFixed(3)}x | VolatilitÃ© : ${out.features.short.vol.toFixed(3)}\n`;
  text += `ðŸ“Š RSI court : ${out.features.short.rsi.toFixed(1)} | MACD hist : ${out.features.short.macd.hist.toFixed(3)}\n`;
  resEl.textContent = text;

  patternsEl.style.display = 'block';
  patternsEl.innerHTML = `<b>Explications :</b><br>` + out.explanation.map(e=>`â€¢ ${e}`).join('<br>');

  const strat = autoStrategySummary(out.trust2, out.trust3);
  summaryEl.style.display = 'block';
  summaryEl.innerHTML = `<b>RÃ©sumÃ© auto :</b><br>
Action : <span style="color:${strat.action.startsWith('Passer') ? 'var(--bad)' : 'var(--good)'}">${strat.action}</span><br>
Plan : ${strat.plan}<br>
Mise : ${strat.stake}`;

  const avgSeries = values.map((_,i,arr)=>{
    if(i<4) return null;
    return arr.slice(i-4,i+1).reduce((a,b)=>a+b,0)/5;
  });
  renderChart(values, avgSeries);
});
</script>
</body>
</html>
